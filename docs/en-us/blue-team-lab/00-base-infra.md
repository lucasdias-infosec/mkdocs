# Introduction

This stage of the laboratory consists of building the foundational infrastructure that will serve as the base for all security tools implemented later.
Before installing any monitoring or detection solution, priority was given to creating a solid, secure, and controlled environment. The adopted approach considers principles of defensive architecture, environment isolation, and hardening best practices starting from the lowest system layer.
The infrastructure was designed with a focus on:

- Modular organization,
- Security from the operating system installation stage,
- Control over storage and volumes,
- Network isolation for controlled testing,
- Preparation for future lab expansion.

Concepts such as disk encryption with LUKS, volume management with LVM, UEFI mode configuration, and network segmentation in a virtualized environment were applied.
This foundation establishes the necessary groundwork for implementing Blue Team tools, ensuring that the lab is not only functional but also structured with architectural and security awareness.

---

## 1. Laboratory Objective

The objective of this lab is to build a controlled, lightweight, and functional environment intended for hands-on training in Information Security, with a focus on Blue Team activities.
The environment is designed to enable event monitoring, log analysis, threat detection, and the application of defensive techniques, considering a scenario with limited hardware resources.

## 2. Learning and Demonstration Objectives

This lab was designed to enable the acquisition and demonstration of the following competencies:

- Configuration and operation of monitoring and detection tools, such as IDS and SIEM,
- Analysis of suspicious activities and investigation of security incidents,
- Identification of evidence generated by common attacks in corporate environments,
- Application of hardening measures and defensive best practices,
- Demonstration of event correlation processes and alert handling performed by a security analyst.

### 2.1 Scope and Limitations

This lab focuses on the practical study of monitoring, detection, analysis, and incident response mechanisms in a controlled and reduced environment, with emphasis on Blue Team activities.
The objectives of this lab do not include:

- Simulating large-scale production environments,
- Reproducing distributed SOC operations,
- Performing high-availability or performance testing,
- Accurately representing complex corporate infrastructures.

These scope limitations are intentional and aim to keep the environment simple, predictable, and aligned with educational and technical study objectives.

## 3. Simulated Scenario

The lab represents a simplified corporate environment composed of the following elements:

- A Linux server monitored by security tools.
- An analyst workstation from which controlled tests are conducted, such as port scanning, brute-force attacks, and exploitation of vulnerable applications.

The objective of this scenario is to reproduce realistic events for the purpose of studying detection, analysis, and incident response, enabling log correlation and observation of attack behavior in an isolated environment.

### 3.1 Threat Model

The malicious events simulated in the lab represent widely known and documented attacks, with low to medium levels of sophistication, typical of small corporate environments.
Offensive activities are used exclusively as a controlled source of events, with the objective of generating logs, alerts, and evidence for defensive analysis, correlation, and incident response. There is no focus on advanced exploitation, exploit development, or simulation of sophisticated persistent threats.

## 4. Hardware Used

The lab was built on the following hardware:

- CPU: AMD Ryzen 7 (5000 series)
- Memory: 8 GB RAM
- Storage: 256 GB SSD

These specifications impose resource limitations, directly influencing architectural decisions and requiring the adoption of a lightweight and efficient virtualization solution.

## 5. Virtualization Software

The following tools were used for environment virtualization:

- Oracle VirtualBox
- VirtualBox Extension Pack

## 6. Justification for Choosing Oracle VirtualBox

The selection of Oracle VirtualBox as the virtualization platform was based on the following criteria:

- Licensing and Cost: VirtualBox is distributed under an open-source license, allowing free use in personal, academic, and laboratory contexts. This characteristic reduces costs and increases environment flexibility.
- Lightweight and Low Hardware Requirements: VirtualBox has relatively low resource consumption compared to other virtualization solutions, enabling multiple virtual machines to run even on hardware with limited memory and storage.
- Support for Visual Documentation: The tool allows screenshot capture directly from the graphical interface, facilitating:
    - Documentation of procedures,
    - Preparation of technical reports,
    - Visual recording of evidence during studies.
- Ease of Use and Community: The intuitive interface and broad availability of documentation make VirtualBox accessible, while its active community contributes to rapid resolution of technical issues and questions.
- Broad Compatibility: VirtualBox supports multiple operating systems, both as host and guest, including Windows, Linux, and BSD. This compatibility is essential for simulating heterogeneous corporate environments.

## 7. Justification for Using the VirtualBox Extension Pack

The VirtualBox Extension Pack adds advanced functionalities that significantly enhance the realism and utility of the lab.

### 7.1 USB 2.0 and USB 3.0 Support

Allows physical devices connected to the host to be accessed by virtual machines, enabling:

- Testing with external devices,
- Analysis of removable media,
- Simulation of USB-based attacks,
- Use of Wi-Fi adapters, dongles, and external readers.

Without the Extension Pack, these capabilities remain limited.

### 7.2 Network Boot (PXE) Support

Support for Intel PXE network cards enables network boot, allowing simulation of:

- Operating system deployment over the network,
- Scenarios involving DHCP and PXE,
- Real corporate provisioning environments.

### 7.3 VRDP Support (VirtualBox Remote Desktop Protocol)

VRDP allows remote access to virtual machines without direct interaction with the local graphical interface, which is useful for:

- Remote access simulations,
- Managing VMs in headless mode,
- Operating multiple VMs simultaneously with reduced impact on the host.

### 7.4 Improved Host Integration

The Extension Pack includes additional performance and compatibility improvements, contributing to greater stability and smoothness of the virtualized environment.

### 7.5 Importance for Documentation and Studies

The additional features provided by the Extension Pack make the lab more complete and realistic, enabling:

- Recording steps through remote access,
- Tests that depend on USB support,
- Simulation of corporate scenarios that require network boot.

Therefore, the use of the VirtualBox Extension Pack is justified by the significant functional gains it provides for study, controlled testing, and documentation purposes in Information Security.

## 8. Virtual Machine Creation

A dedicated virtual machine was created for the security server using Oracle VirtualBox. The configuration prioritizes lightweight operation, environment control, and fidelity to real corporate server scenarios commonly found in Information Security contexts.

## 9. Operating System

- Distribution: Ubuntu Server
- Version: 24.04.03 LTS
- Architecture: amd64 (64-bit)

The choice of Ubuntu Server 24.04 LTS is based on the following factors:

- LTS version, ensuring stability and long-term support,
- No graphical interface by default, reducing memory consumption,
- Broad documentation and compatibility with Blue Team tools,
- Common use in corporate environments, increasing lab realism.

## 10. Virtual Machine Hardware Configuration

### 10.1 RAM

- Allocated RAM: 3 GB

### 10.2 Processor

- vCPUs: 2

## 11. Firmware and Boot Configuration

### 11.1 Boot Mode

The virtual machine was configured to boot in UEFI (Unified Extensible Firmware Interface) mode, replacing legacy BIOS.
Justification for this choice:

- UEFI is the predominant standard in modern corporate servers and workstations,
- Provides a more robust and structured boot architecture,
- Enables support for advanced security and management features,
- Aligns the lab with contemporary real-world infrastructure scenarios.

## 12. Network Configuration

### 12.1 Host-Only Adapter (Lab Operation)

During normal operation, the lab runs with a network adapter configured in Host-Only mode.
This mode creates a private network between the host and the virtual machine, without direct internet access or exposure to external networks, enabling controlled and predictable communication.
The use of Host-Only mode serves the following purposes:

- Ensuring security isolation during simulated attack execution,
- Preventing malicious traffic leakage to real networks,
- Simulating an internal corporate scenario where an analyst accesses non-public servers,
- Providing clean and controlled traffic for analysis by tools such as IDS and SIEM.

### 12.2 Promiscuous Mode

- Configuration: Allow VMs

This configuration is required to allow network packet observation by traffic analysis tools such as Suricata, enabling detection and monitoring studies.

### 12.3 NAT Adapter (Provisioning Phase)

During the initial provisioning phase, a NAT network adapter may be temporarily enabled.
Exclusive purposes:

- Operating system updates,
- Installation of packages and dependencies.

After provisioning is complete and a stable base snapshot is created, the NAT adapter is removed, keeping the lab operating in an isolated Host-Only mode.

## 13. Operating System Installation

### 13.1 Installation Type

- Ubuntu Server – minimized installation

The minimized installation option was chosen in order to:

- Reduce the system’s initial attack surface,
- Lower resource consumption (RAM and storage),
- Avoid unnecessary services and packages,
- Maintain greater control over installed components.

This approach ensures that each tool and dependency is installed consciously and documented later, aligning the environment with hardening best practices and the principle of least privilege.
Even in minimized mode, the system retains essential functionality for remote administration and manual configuration of services required for the lab.

## 14. Storage Configuration

### 14.1 Disk Scheme

- LUKS + LVM
- Installer default layout

## 15. Remote Access Configuration

### 15.1 SSH

- OpenSSH Server installed during setup

This allows remote server administration and reflects common management practices in corporate environments.

### 15.2 SSH Keys

SSH key import was not performed at this stage, allowing proper hardening policies to be defined later.

## 16. Additional Services

No additional snaps were installed during the initial setup.
Justification:

- Keep the system clean and controlled,
- Avoid unnecessary resource consumption,
- Ensure each tool is installed and documented deliberately.

## 17. Installation Completion

After installation:

- The system was rebooted,
- The encrypted disk was manually unlocked,
- Hostname, system version, and SSH access information were correctly displayed.

This confirms that:

- The boot process was successfully completed,
- LUKS and LVM are operational,
- The server is ready for security tool configuration.

## 18. Logical Volume Configuration over Encrypted Layer (LUKS + LVM)

With the system already installed over an encrypted layer (LUKS) and using LVM for logical volume management, dedicated volumes were created for:

- System and security tool logs,
- Vulnerable application data and auxiliary services.

This segmentation aims to provide:

- Improved structural organization,
- Isolation between system, logs, and application data,
- Greater storage control,
- Simulation of best practices adopted in corporate environments.

### 18.1 LVM Structure Preparation

#### 18.1.2 Volume Group Verification

Available free space was identified in the `ubuntu-vg` Volume Group, residing on the encrypted LUKS container.
This verification ensured that new volumes could be created without resizing the root volume.

#### 18.1.3 Logical Volume Creation

Two new Logical Volumes were created:

- `lv_logs`

Size: 10 GB  
Purpose: Storage of system logs, Suricata, Wazuh, Rsyslog, and other monitoring tools.

- `lv_srv`

Size: Remaining available space in the Volume Group  
Purpose: Storage of vulnerable applications (e.g., DVWA, Juice Shop) and associated data.

The creation of these volumes maintains separation between:

- Operating system (`/`),
- Critical logs (`/var/log`),
- Application data (`/srv`).

### 18.2 Volume Formatting and Preparation

#### 18.2.1 Filesystem

The volumes were formatted with:

- Filesystem: ext4.

Justification:

- Stable,
- Lightweight,
- Widely supported,
- Suitable for laboratory environments.

#### 18.2.2 Migration of Existing Data

To ensure integrity and preservation of permissions:

- The `rsync` tool was installed,
- Existing content from `/var/log` was synchronized to the new dedicated volume.

The use of `rsync` allowed:

- Preservation of permissions,
- Preservation of attributes,
- Preservation of timestamps,
- Reduced risk of inconsistencies.

### 18.3 Persistence and Permanent Mounting

#### 18.3.1 Updating the `/etc/fstab` File

To ensure automatic mounting during system startup, the `/etc/fstab` file was edited to include the following entries:

- `/dev/mapper/ubuntu--vg-lv_logs` → mounted at `/var/log`,
- `/dev/mapper/ubuntu--vg-lv_srv` → mounted at `/srv`.

This configuration ensures that:

- The volumes are automatically mounted during boot,
- The system maintains structural consistency after reboots.

#### 18.3.2 System Configuration Update

After modifying `fstab`, the following command was executed:

- `systemctl daemon-reload`

### 18.4 Validation

After rebooting the system, the following was verified:

- `/var/log` is mounted on the dedicated `lv_logs` volume,
- `/srv` is mounted on the `lv_srv` volume,
- The system boots without errors,
- The LUKS container is correctly unlocked during boot,
- LVM recognizes all created Logical Volumes.

---

# Conclusion

Building the infrastructure foundation established the technical pillars of the lab, ensuring a controlled, isolated, and secure environment for implementing monitoring and detection tools.
The use of UEFI, encryption with LUKS, and volume management with LVM provided greater storage control and increased data protection. Network segmentation and virtual environment isolation ensure that tests can be performed without external impact.
This stage was essential for applying fundamental security concepts such as:

- Defense in depth,
- Principle of least privilege,
- Environment isolation,
- Architectural planning.

With the foundation consolidated, the lab is prepared for the installation and configuration of security tools, enabling the simulation of real-world monitoring and incident analysis scenarios.
The created infrastructure is not only functional but structured with a focus on security best practices from the most fundamental system layer.

---

[Versão pt-BR](../../pt-br/blue-team-lab-pt-br/00-base-infra.md)
